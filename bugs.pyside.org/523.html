<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Bug 523 &ndash; QWidget.winId() returns PyCObject (expected unsigned long)</title>


<link rel="Top" href="http://bugs.pyside.org/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=523&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=523">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=523">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=523">



    
    
    <link href="skins/standard/global.css"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css" rel="stylesheet"
        type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css" rel="stylesheet"
        type="text/css" ><link href="skins/standard/global.css" rel="stylesheet"
        type="text/css" ><link href="skins/standard/show_bug.css" rel="stylesheet"
        type="text/css" ><!--[if lte IE 7]>
      



  <link href="skins/standard/IE-fixes.css" rel="stylesheet"
        type="text/css" >
<![endif]-->

    <link href="skins/contrib/OpenBossa/global.css" rel="stylesheet"
        type="text/css" title="OpenBossa">
<link href="skins/contrib/Dusk/global.css" rel="alternate stylesheet"
        type="text/css" title="Dusk">

    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js"></script><script type="text/javascript" src="js/yui/connection/connection-min.js"></script><script type="text/javascript" src="js/yui/json/json-min.js"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js"></script><script type="text/javascript" src="js/global.js"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1000
            },

            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    // -->
    </script>
<script type="text/javascript" src="js/util.js"></script><script type="text/javascript" src="js/field.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" >
  </head>



  <body onload=""
        class="bugs-pyside-org bz_bug bz_status_CLOSED bz_product_PySide bz_component_Documentation bz_bug_523 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td><a id="pysidelogo" href="http://www.pyside.org">&nbsp;</a></td>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;523</p>
    </td>

    <td id="subtitle">
      <p class="subheader">QWidget.winId() returns PyCObject (expected unsigned long)</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2011-11-03 18:46:58 EET</p>
    </td>
</tr>
</table>

<table id="lang_links_container" cellpadding="0" cellspacing="0"
       class="bz_default_hidden"><tr><td>
</td></tr></table>
<ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="http://bugs.pyside.org/show_bug.cgi?id=523&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>
  <form action="http://bugs.pyside.org/show_bug.cgi?id=523" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_top"
        onsubmit="return check_mini_login_fields( '_top' );"
  >
    <input id="Bugzilla_login_top" 
           class="bz_login"
           name="Bugzilla_login"
           onfocus="mini_login_on_focus('_top')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_top" 
           name="Bugzilla_password"
           type="password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_top" value="password"
           onfocus="mini_login_on_focus('_top')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_top">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_top');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_top');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
<li id="forgot_container_top">
  <span class="separator">| </span>
  <a id="forgot_link_top" href="http://bugs.pyside.org/show_bug.cgi?id=523&amp;GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('_top')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form_top"
        class="mini_forgot bz_default_hidden">
    <label>Login: <input type="text" name="loginname" size="20"></label>
    <input id="forgot_button_top" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
  </form>
</li>
</ul>
</div> 

<div id="bugzilla-body">
<div id="message">
<p><strong>PySide Bugzilla Closed for New Bugs</strong></p>
<p>PySide is now a Qt Add-on and uses the Qt Project's <a href="https://bugreports.qt-project.org/">JIRA Bug Tracker</a> instead of this Bugzilla instance. This Bugzilla is left for reference purposes.</p>
</div>

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
  <!--
  
  /* Outputs a link to call replyToComment(); used to reduce HTML output */
  function addReplyLink(id, real_id) {
      /* XXX this should really be updated to use the DOM Core's
       * createElement, but finding a container isn't trivial.
       */
        document.write('[<a href="#add_comment" onclick="replyToComment(' + 
                       id + ',' + real_id + '); return false;">reply<' + '/a>]');
  }

  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id) {
      var prefix = "(In reply to comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);

        /* make sure we split on all newlines -- IE or Moz use \r and \n
         * respectively.
         */
        text = text.split(/\r|\n/);

        for (var i=0; i < text.length; i++) {
            replytext += "> " + text[i] + "\n"; 
        }

        replytext = prefix + replytext + "\n";


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      textarea.value += replytext;

      textarea.focus();
  }

  if (typeof Node == 'undefined') {
      /* MSIE doesn't define Node, so provide a compatibility object */
      window.Node = {
          TEXT_NODE: 3,
          ENTITY_REFERENCE_NODE: 5
      };
  }

  /* Concatenates all text from element's childNodes. This is used
   * instead of innerHTML because we want the actual text (and
   * innerText is non-standard).
   */
  function getText(element) {
      var child, text = "";
      for (var i=0; i < element.childNodes.length; i++) {
          child = element.childNodes[i];
          var type = child.nodeType;
          if (type == Node.TEXT_NODE || type == Node.ENTITY_REFERENCE_NODE) {
              text += child.nodeValue;
          } else {
              /* recurse into nodes of other types */
              text += getText(child);
          }
      }
      return text;
  }


  /* Index all classifications so we can keep track of the classification
   * for the selected product, which could control field visibility.
   */
  var all_classifications = new Array(1);
      all_classifications['PySide'] = 'Unclassified';

  //-->
  </script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2011-11-03 18:46:58">
  <input type="hidden" name="longdesclength" value="19">
  <input type="hidden" name="id" value="523">
  <input type="hidden" name="token" value="1336600152-4d46a6e14812bbba30c8953fbcef93b1">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=523"><b>Bug&nbsp;523</b></a> -<span id="summary_alias_container" class="bz_default_hidden"> 
      <span id="short_desc_nonedit_display">QWidget.winId() returns PyCObject (expected unsigned long)</span>
     </span>
  
       
    <div id="summary_alias_input">
      <table id="summary">  
        
        <tr>
          <td>
            <label accesskey="s" for="short_desc"><u>S</u>ummary</label>:
          </td>
          <td>QWidget.winId() returns PyCObject (expected unsigned long)
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('QWidget.winId() returns PyCObject (expected unsigned long)', '');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <td class="field_label">
      <b><a href="page.cgi?id=fields.html#status">Status</a></b>:
    </td>
    <td id="bz_field_status">
      <span id="static_bug_status">CLOSED
          FIXED
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >PySide</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=PySide"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Documentation</td>
    </tr>
    <tr>
      <td class="field_label">
        <label for="version"><b>Version</b></label>:
      </td>
<td>HEAD
  </td>
    </tr>
        
    
        
    <tr>
      <td class="field_label">
        <label for="rep_platform" accesskey="h"><b>Platform</b></label>:
      </td>
      <td class="field_value">Other
       Other
       <script type="text/javascript">
         assignToDefaultOnChange(['product', 'component']);
       </script>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <td class="field_label">
        <label for="priority" accesskey="i">
          <b><a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></b></label>:
      </td>
      <td>P3
       normal
      </td>
    </tr>            
          
          <tr>
      <td class="field_label">
        <b><a href="page.cgi?id=fields.html#assigned_to">Assigned To</a></b>:
      </td>
      <td><span class="vcard"><span class="fn">Hugo Parente Lima</span>
</span>
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr>
    <td class="field_label">
      <label for="bug_file_loc" accesskey="u"><b>
          <u>U</u>RL</b></label>:
    </td>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr><th class="field_label">
    <label for="dependson">Depends&nbsp;on</label>:
  </th>
  <td>    
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label">
    <label for="blocked" accesskey="b"><u>B</u>locks</label>:
  </th>
  <td>    
    <span id="blocked_input_area">
    </span>
    
  </td>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=523&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=523">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <td class="field_label">
      <b>Reported</b>:
    </td>
    <td>2010-12-03 11:16 EET by <span class="vcard"><span class="fn">Vladimir Rutsky</span>
</span>
    </td>
  </tr>
  
  <tr>
    <td class="field_label">
      <b> Modified</b>:
    </td>
    <td>2011-11-03 18:46 EET 
      (<a href="show_activity.cgi?id=523">History</a>)
    </td>
  
  </tr>
         <tr>
      <td class="field_label">
        <label for="newcc" accesskey="a"><b>CC List</b>:</label>
      </td>
      <td>10 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" name="cc" multiple="multiple" size="5">
                <option value="bruno.araujo">bruno.araujo</option>
                <option value="hugo.lima">hugo.lima</option>
                <option value="lauro.neto">lauro.neto</option>
                <option value="luciano.wolf">luciano.wolf</option>
                <option value="marcelo.lira">marcelo.lira</option>
                <option value="matti.p.airas">matti.p.airas</option>
                <option value="renatox">renatox</option>
                <option value="rutsky.vladimir">rutsky.vladimir</option>
                <option value="samu.niveri">samu.niveri</option>
                <option value="willer.moreira">willer.moreira</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
    }
    else {
        link.innerHTML = "Hide Obsolete";
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>



  <tr class="bz_attach_footer">
    <td colspan="2">
        <a href="attachment.cgi?bugid=523&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table><tr><td><fieldset>
        <legend>Note</legend>
        You need to
        <a href="show_bug.cgi?id=523&amp;GoAheadAndLogIn=1">log in</a>
         before you can comment on or make changes to this bug.
      </fieldset></table><tr></td>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js" type="text/javascript">
</script>







<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c0">Description</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Vladimir Rutsky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-12-03 11:16:44 EET
        </span>
      </div>



<pre class="bz_comment_text" >According to documentation QWidget.winId() should return unsigned long
(<a href="http://www.pyside.org/docs/pyside/PySide/QtGui/QWidget.html#PySide.QtGui.QWidget.winId">http://www.pyside.org/docs/pyside/PySide/QtGui/QWidget.html#PySide.QtGui.QWidget.winId</a>),
but current implementation returns PyCObject without any method for converting
it to integer type.

Consider following example:


import sys
from PySide import QtCore, QtGui

app = QtGui.QApplication(sys.argv)

win = QtGui.QWidget()

win.resize(320, 240)
win.setWindowTitle(&quot;Hello, World!&quot;)
win.show()

print win.winId()
print dir(win.winId())

print win.effectiveWinId()
print dir(win.effectiveWinId())

print win.nativeParentWidget()

sys.exit(app.exec_())



output:
&lt;PyCObject object at 0x00A4F2A8&gt;
['__class__', '__delattr__', '__doc__', '__format__', '__getattribute__',
'__hash__', '__init__', '__new__', '__reduce__', '__reduce_ex__', '__repr__',
'__setatr__', '__sizeof__', '__str__', '__subclasshook__']
&lt;PyCObject object at 0x00A4F2A8&gt;
['__class__', '__delattr__', '__doc__', '__format__', '__getattribute__',
'__hash__', '__init__', '__new__', '__reduce__', '__reduce_ex__', '__repr__',
'__setatr__', '__sizeof__', '__str__', '__subclasshook__']
None</pre>
    </div>
  <div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Matti Airas</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-12-03 12:55:37 EET
        </span>
      </div>



<pre class="bz_comment_text" >Thanks for the bug report! Prioritizing P3 - this will be fixed during our
upcoming sprints. Before the 1.0.0 release, in any case. :-)</pre>
    </div>
  <div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Hugo Parente Lima</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-12-16 15:55:25 EET
        </span>
      </div>



<pre class="bz_comment_text" >winId returns a opaque pointer on Qt, on X11 is valid to cast it to a integer,
but what about Windows? What about Mac?</pre>
    </div>
  <div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Vladimir Rutsky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-12-17 07:26:29 EET
        </span>
      </div>



<pre class="bz_comment_text" >According to documentation [1] WId is not mandatory integer type (and on some
platforms it is definitely pointer type), so if PySide follows original Qt
winId() meaning, error not in PySide winId() implementation, but in
documentation [2] - it says that winId() returns unsigned long.

On different platforms winId() returns different things (some quotes from Qt
4.7.1 src\gui\kernel\qwindowdefs.h and src\gui\kernel\qwindowdefs_win.h):
Mac: typedef int WId;
Windows: typedef HWND WId;
X11: typedef unsigned long  WId;
Symbian: typedef CCoeControl * WId;

What kind of return object users of winId() expect and how they should use it?

Here is my use case.

Currently I'm developing under Windows. I need to create QWidget, get its HWND,
pass it to C++ wrapper, which will initialize some 3D engine on obtained HWND
so that engine will render into widget.
C++ wrapper is written using Boost.Python, wrapper function accepts result of
winId() as &quot;PyObject *pPyObj&quot;, and then converts it like this: 
  hwnd = (HWND)PyCObject_AsVoidPtr(pPyObj)

This looks quite ugly (accepting abstract PyObject and converting it to pointer
with some semantic), any ideas how this should be implemented better?

[1] <a href="http://doc.qt.nokia.com/stable/qwidget.html#winId">http://doc.qt.nokia.com/stable/qwidget.html#winId</a>
[2]
<a href="http://www.pyside.org/docs/pyside/PySide/QtGui/QWidget.html#PySide.QtGui.QWidget.winId">http://www.pyside.org/docs/pyside/PySide/QtGui/QWidget.html#PySide.QtGui.QWidget.winId</a></pre>
    </div>
  <div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Hugo Parente Lima</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-12-17 11:32:28 EET
        </span>
      </div>



<pre class="bz_comment_text" >Yes, it's a doc error.

The documentation was auto-generated on Linux, and the generator resolved the
typedefed type returned by winId().

In other words... we need to change the return value on docs to PyCObject.

About your problem, your solution looks feasible for me, not ugly just
necessary :-).</pre>
    </div>
  <div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Vladimir Rutsky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-12-17 12:36:27 EET
        </span>
      </div>



<pre class="bz_comment_text" >Ok. Anyway working with winId() result should be additionally documented.

Also, if winId() result will not be convertible to integer type, then this is
another place where PySide differs with PyQt, and also should be documented.</pre>
    </div>
  <div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Hugo Parente Lima</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-12-17 21:08:24 EET
        </span>
      </div>



<pre class="bz_comment_text" >What PyQt4 winId() returns under Windows and Mac?

We can return a unsigned long on X11 and Windows and PyCObject on other
platforms.</pre>
    </div>
  <div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Vladimir Rutsky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2010-12-21 14:16:07 EET
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=523#c6">comment #6</a>)
<span class="quote">&gt; What PyQt4 winId() returns under Windows and Mac?</span >

Documentation says &quot;int&quot;
(<a href="http://www.riverbankcomputing.co.uk/static/Docs/PyQt4/html/qwidget.html#winId">http://www.riverbankcomputing.co.uk/static/Docs/PyQt4/html/qwidget.html#winId</a>)
but actual result is sip.voidptr.

import sys
from PyQt4 import QtCore, QtGui
from pprint import pprint

app = QtGui.QApplication(sys.argv)

win = QtGui.QWidget()

win.resize(320, 240)
win.setWindowTitle(&quot;Hello, World!&quot;)
win.show()

w_id = win.winId()
print &quot;w_id:&quot;, w_id
print &quot;type(w_id):&quot;, type(w_id)
print &quot;dir(w_id):&quot;
pprint(dir(w_id))
print &quot;int(w_id):&quot;, int(w_id)

#sys.exit(app.exec_())

produces:

w_id: &lt;sip.voidptr object at 0x00A4F368&gt;
type(w_id): &lt;type 'sip.voidptr'&gt;
dir(w_id):
['__class__',
 '__delattr__',
 '__doc__',
 '__format__',
 '__getattribute__',
 '__hash__',
 '__hex__',
 '__init__',
 '__int__',
 '__new__',
 '__reduce__',
 '__reduce_ex__',
 '__repr__',
 '__setattr__',
 '__sizeof__',
 '__str__',
 '__subclasshook__',
 'ascobject',
 'asstring',
 'getsize',
 'getwriteable',
 'setsize',
 'setwriteable']
int(w_id): 96207802</pre>
    </div>
  <div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Hugo Parente Lima</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-01-13 14:00:59 EET
        </span>
      </div>



<pre class="bz_comment_text" >I fixed the documentation of QWidget::winId() to reflect the reallity.

marking this bug as fixed...

commit:
pyside/a78108efe3a4815226e2fe26713cd0f495d655b7</pre>
    </div>
  <div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">renato filho</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-01-21 15:44:40 EET
        </span>
      </div>



<pre class="bz_comment_text" >release beta4</pre>
    </div>
  <div id="c10" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Samu Niveri</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-02-20 08:15:02 EET
        </span>
      </div>



<pre class="bz_comment_text" >winId() returns PyCObject on wine with python 2.6</pre>
    </div>
  <div id="c11" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Hugo Parente Lima</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-02-21 15:10:11 EET
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=523#c10">comment #10</a>)
<span class="quote">&gt; winId() returns PyCObject on wine with python 2.6</span >

And what's wrong with that? we can't cast a void pointer to a integer, and on
Windows winId() returns a void pointer.

Re-closing the bug.</pre>
    </div>
  <div id="c12" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Samu Niveri</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-02-21 15:32:03 EET
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=523#c11">comment #11</a>)
<span class="quote">&gt; And what's wrong with that? we can't cast a void pointer to a integer, and on
&gt; Windows winId() returns a void pointer.</span >

Ok, I was just bit supprised that it worked with 2.7 python + pyside + Windows
Vista, and when changed to python 2.6 + wine then there was no handle for doing
anything useful for Qt-windows. How do I get the handle in windows for now on?</pre>
    </div>
  <div id="c13" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Hugo Parente Lima</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-02-21 16:22:41 EET
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=523#c12">comment #12</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=523#c11">comment #11</a>)
&gt; &gt; And what's wrong with that? we can't cast a void pointer to a integer, and on
&gt; &gt; Windows winId() returns a void pointer.
&gt; 
&gt; Ok, I was just bit supprised that it worked with 2.7 python + pyside + Windows
&gt; Vista, and when changed to python 2.6 + wine then there was no handle for doing
&gt; anything useful for Qt-windows. How do I get the handle in windows for now on?</span >

There's a handle, but the problem is that on Windows windows handlers are void
pointers and we can't transform a void pointer to a ordinary number.

What the library that you are using expect to receive as a window handler? a
custom class created by this library? a PyCObject? an integer? We believe that
the safest way is to use PyCObjects as it's part of Python C API and it's
readonly because void pointers are not meant to be touched by Python code, just
passed around to another built-in module.

On X11 window handlers are number, so we can return numbers without problems,
on Mac it can be two different pointer types depending if Qt was linked against
Cocoa or Carbon, so a PyCObject is returned too.</pre>
    </div>
  <div id="c14" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Samu Niveri</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-02-21 16:33:12 EET
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=523#c13">comment #13</a>)
<span class="quote">&gt; There's a handle, but the problem is that on Windows windows handlers are void
&gt; pointers and we can't transform a void pointer to a ordinary number.
&gt; 
&gt; What the library that you are using expect to receive as a window handler? a
&gt; custom class created by this library? a PyCObject? an integer? We believe that
&gt; the safest way is to use PyCObjects as it's part of Python C API and it's
&gt; readonly because void pointers are not meant to be touched by Python code, just
&gt; passed around to another built-in module.
&gt; 
&gt; On X11 window handlers are number, so we can return numbers without problems,
&gt; on Mac it can be two different pointer types depending if Qt was linked against
&gt; Cocoa or Carbon, so a PyCObject is returned too.</span >

I`m building add-in with python to native windows application, so I want to use
Windows SetParent API that needs integer handle. But if there is smarter way
I`m interested as this SetParent stuff is not good solution, but needed..</pre>
    </div>
  <div id="c15" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Hugo Parente Lima</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-02-21 17:19:23 EET
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=523#c14">comment #14</a>)
<span class="quote">&gt; I`m building add-in with python to native windows application, so I want to use
&gt; Windows SetParent API that needs integer handle. But if there is smarter way
&gt; I`m interested as this SetParent stuff is not good solution, but needed..</span >

This is the problem, the guys from win32-python uses a integer to store a C
opaque pointer, IMO this is just wrong, but at the same time I can't enforce
them to accept PyCObjects as argument.

OTOH is there's no way at python level to transform a PyCObject into a integer
variable and the python win32 API only accepts integer, the winId() method
would be useless on Windows. IMO is better to raise this question on the
mailing list before change any behaviour, could you do that?</pre>
    </div>
  <div id="c16" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Samu Niveri</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-02-21 18:22:14 EET
        </span>
      </div>



<pre class="bz_comment_text" ><span class="quote">&gt; This is the problem, the guys from win32-python uses a integer to store a C
&gt; opaque pointer, IMO this is just wrong, but at the same time I can't enforce
&gt; them to accept PyCObjects as argument.
&gt; 
&gt; OTOH is there's no way at python level to transform a PyCObject into a integer
&gt; variable and the python win32 API only accepts integer, the winId() method
&gt; would be useless on Windows. IMO is better to raise this question on the
&gt; mailing list before change any behaviour, could you do that?</span >

Maybe I just need to figure out some other way to do this, as the Windows API
is not the best solution..</pre>
    </div>
  <div id="c17" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Hugo Parente Lima</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-03-04 15:10:40 EET
        </span>
      </div>



<pre class="bz_comment_text" >Closing bug due to 1.0.0 release.</pre>
    </div>
  <div id="c18" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=523#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user"><span class="vcard"><span class="fn">Vladimir Rutsky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2011-11-03 18:46:58 EET
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="show_bug.cgi?id=523#c15">comment #15</a>)
<span class="quote">&gt; OTOH is there's no way at python level to transform a PyCObject into a integer
&gt; variable and the python win32 API only accepts integer, the winId() method
&gt; would be useless on Windows. IMO is better to raise this question on the
&gt; mailing list before change any behaviour, could you do that?</span >

There is solution for converting PyCObject into integer on Windows (tested on
Python 2.6 and PySide from PySide-1.0.7qt474.win32-py2.6.exe):

    pycobject_hwnd = widget.winId()

    import ctypes
    ctypes.pythonapi.PyCObject_AsVoidPtr.restype = ctypes.c_void_p
    ctypes.pythonapi.PyCObject_AsVoidPtr.argtypes = [ctypes.py_object]

    int_hwnd = ctypes.pythonapi.PyCObject_AsVoidPtr(pycobject_hwnd)

(Based on example from here: <a href="http://pygame.org/wiki/PyOgre">http://pygame.org/wiki/PyOgre</a>).</pre>
    </div>
  


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=523">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=523">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=523">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="http://bugs.pyside.org/show_bug.cgi?id=523&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>
  <form action="http://bugs.pyside.org/show_bug.cgi?id=523" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_bottom"
        onsubmit="return check_mini_login_fields( '_bottom' );"
  >
    <input id="Bugzilla_login_bottom" 
           class="bz_login"
           name="Bugzilla_login"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_bottom" 
           name="Bugzilla_password"
           type="password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_bottom" value="password"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_bottom">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
<li id="forgot_container_bottom">
  <span class="separator">| </span>
  <a id="forgot_link_bottom" href="http://bugs.pyside.org/show_bug.cgi?id=523&amp;GoAheadAndLogIn=1#forgot"
     onclick="return show_forgot_form('_bottom')">Forgot Password</a>
  <form action="token.cgi" method="post" id="forgot_form_bottom"
        class="mini_forgot bz_default_hidden">
    <label>Login: <input type="text" name="loginname" size="20"></label>
    <input id="forgot_button_bottom" value="Reset Password" 
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
  </form>
</li>
</ul>
  </li>

  
    

  


  
</ul>

  <div class="outro"></div>
</div>


</body>
</html>